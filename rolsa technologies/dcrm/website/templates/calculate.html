{% extends 'base.html' %}

{% block title %}Calculate Emissions{% endblock %}

{% block content %}
  <main class="container">
    <h1>Emission & Cost Calculator</h1>

    <form method="post" class="calc-form" novalidate>
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="error">{{ form.non_field_errors }}</div>
      {% endif %}

      <label>Distance (km):
        {{ form.distance }}
        {% if form.distance.errors %}
          <div class="error">{{ form.distance.errors }}</div>
        {% endif %}
      </label>

      <label>Consumption (L per 100 km):
        {{ form.consumption }}
        {% if form.consumption.errors %}
          <div class="error">{{ form.consumption.errors }}</div>
        {% endif %}
      </label>

      <label>Price (per litre):
        {{ form.price }}
        {% if form.price.errors %}
          <div class="error">{{ form.price.errors }}</div>
        {% endif %}
      </label>

      <label>Emission factor (kg CO2 per litre):
        {{ form.emission_factor }}
        {% if form.emission_factor.errors %}
          <div class="error">{{ form.emission_factor.errors }}</div>
        {% endif %}
      </label>

      <button type="submit" class="btn">Calculate</button>
    </form>

    {% if form and form.is_bound and form.is_valid %}
      <div class="results">
        <h2>Results</h2>
        <p>Fuel used: {{ fuel_used|floatformat:1 }} L</p>
        <p>Cost: {{ cost|floatformat:2 }}</p>
        <p>Estimated emissions: {{ emissions|floatformat:2 }} kg CO2</p>
      </div>
    {% endif %}

  </main>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function(){
    var el = document.querySelector('input[name="distance"]');
    if(el) el.focus();
  });
</script>
{% endblock %}